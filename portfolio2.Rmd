---
title: "Portfolio 2"
author: "Allison Li"
date: "03042025"
output: 
  html_document: 
    toc: yes
    toc_float: yes
---

```{r load-packages, message=FALSE}
##install packages
##install.packages("psych")
##For this portfolio, I would like to use the dataset from my thesis study.
library(psych)
library(ggplot2)
library(tidyverse)
library(dplyr)
Thesis <- read_sav("~/Downloads/Thesis.sav")
```

### Step 1: clean data
```{r clean data}
##The first step is to clean data, and I started with getting rid of participants that did not finished the study, as well as deleting variable that does not have any data, such as recipient name.  
Thesis_clean <- Thesis %>% 
  select(-RecipientLastName, -RecipientFirstName, -RecipientEmail, -ExternalReference, -DistributionChannel, -browser_info_Resolution, -StartDate, -EndDate, -browser_info_Browser, -browser_info_Version, -IPAddress, -RecordedDate, -LocationLatitude, -LocationLongitude, -ResponseId, -UserLanguage, -browser_info_Operating_System, -robot_timer_First_Click, -robot_timer_Last_Click, -robot_timer_Page_Submit, -robot_timer_Click_Count)
Thesis_clean <- Thesis[-c(1), ]
##Keep only participants with progress >= 50
Thesis_clean <- Thesis %>% 
  filter(Progress >= 50)
```


```{r scoring scales}
##Reverse coding for BPS
Thesis_clean <- Thesis_clean %>%
  mutate(across(everything(), ~ as.numeric(.)))
Thesis_scale <- Thesis_clean %>%
  mutate(
    across(c(BPS_1, BPS_2, BPS_3, BPS_6, BPS_9, BPS_11), ~ recode(., 
      `1` = 5, `2` = 4, `4` = 2, `5` = 1)), ##Bullshit Propensity Scale

    across(c(self_esteem_2, self_esteem_5, self_esteem_6, self_esteem_8, self_esteem_9), ~ recode(., 
      `1` = 4, `11` = 3, `12` = 2, `13` = 1)), ##Rosenberg Self-esteem Scale

    across(c(self_esteem_1, self_esteem_3, self_esteem_4, self_esteem_7, self_esteem_10), ~ recode(., 
      `1` = 1, `11` = 2, `12` = 3, `13` = 4)), ##Rosenberg Self-esteem Scale
    
    across(c(ncog3, ncog4, ncog5, ncog7, ncog8, ncog9, ncog12, ncog16, ncog17), ~ recode(., 
      `1` = 5, `2` = 4, `4` = 2, `5` = 1)), ##Need for Cognition
    
    across(c(DTS_Nar_2, DTS_Nar_6, DTS_Nar_8, DTS_Path_2, DTS_Path_7), ~ recode(., 
      `1` = 5, `2` = 4, `4` = 2, `5` = 1)), ##The Short Dark Triad
    
    across(c(NPI_1, NPI_2, NPI_3, NPI_4, NPI_5, NPI_6, NPI_7, NPI_8, NPI_9, NPI_10, NPI_11, NPI_12, NPI_13, NPI_14, NPI_15, NPI_16), ~ recode(., 
      `1` = 2, `2` = 1)), ##Narcissistic Personality Inventoryâ€“16
    
    across(c(A4CTS_1, A4CTS_2, A4CTS_3, A4CTS_4, A4CTS_5, A4CTS_6, A4CTS_19, A4CTS_20, A4CTS_21, A4CTS_22, A4CTS_23, A4CTS_24), ~ recode(.,
      `1` = 6, `2` = 5, `3` = 4, `4` = 3, `5` = 2, `6` = 1)), ##4-Component Thinking Styles Questionnaire
    
    across(c(LSRP_SPS_3, LSRP_SPS_7, LSRP_PPS_10, LSRP_PPS_12, LSRP_PPS_14, LSRP_PPS_16), ~ recode(.,
      `1` = 4, `2` = 3, `3` = 2, `4` = 1)), ##Levenson Self-Report Psychopathy Scale
   
    across(c(aopen3, aopen4, aopen5, aopen7, aopen8), ~ recode(.,
      `1` = 6, `3` = 5, `4` = 4, `5` = 3, `6` = 2, `7` = 1)), ##Actively Open-Minded Thinking about Evidence Scale
    across(c(aopen1, aopen2, aopen6), ~ recode(.,
      `1` = 1, `3` = 2, `4` = 3, `5` = 4, `6` = 5, `7` = 6)),
    
    across(c(nclos2, nclos5, nclos15, nclos12, nclos17, nclos18, nclos19, nclos20, nclos22, nclos24, nclos27, nclos28, nclos34, nclos37, nclos38, nclos42), ~ recode(.,
      `1` = 6, `2` = 5, `3` = 4, `4` = 3, `5` = 2, `6` = 1)), ##Need for closure
    
    across(c(hex1, hex9, hex10, hex12, hex14, hex15, hex19, hex20, hex21, hex24, hex26, hex28, hex30, hex31, hex32, hex35, hex41, hex44, hex46, hex48, hex49, hex52, hex53, hex55, hex56, hex57, hex59, hex60), ~ recode(.,
      `1` = 5, `2` = 4, `4` = 2, `5` = 1)) ##HEXACO
    )
```

```{r test from gpt}
##Create an empty list to store results
scale_stats <- list()

##Function to compute scale statistics
compute_scale_stats <- function(data, vars, scale_name) {
  scale_data <- data[, vars]
##Convert all variables to numeric
  scale_data <- data.frame(lapply(scale_data, function(x) as.numeric(as.character(x))))
 
   # Remove rows where all values are NA
  if (all(is.na(scale_data))) {
    cat("\nScale:", scale_name, "has only missing values, skipping.\n")
    return()
  }
  
##Compute Cronbach's Alpha
  alpha_result <- alpha(scale_data, check.keys = TRUE)
  alpha_value <- round(alpha_result$total$raw_alpha, 3)
##Compute row means and descriptive statistics
  row_means <- rowMeans(scale_data, na.rm = TRUE)
  if (all(is.na(row_means))) {
    mean_value <- sd_value <- min_value <- max_value <- NA
  } else {
    mean_value <- round(mean(row_means, na.rm = TRUE), 3)
    sd_value <- round(sd(row_means, na.rm = TRUE), 3)
    min_value <- round(min(row_means, na.rm = TRUE), 3)
    max_value <- round(max(row_means, na.rm = TRUE), 3)
  }
  
##Print clean results
  cat("\nScale:", scale_name, "\n")
  cat("Cronbach's Alpha:", alpha_value, "\n")
  cat("Mean:", mean_value, "| SD:", sd_value, "| Range:", min_value, "-", max_value, "\n")
  
##Store results in a list
  scale_stats[[scale_name]] <<- c(Alpha = alpha_value, Mean = mean_value, SD = sd_value, Min = min_value, Max = max_value)
}

##Apply function to each scale
scales <- list(
##Bullshit Frequency scale general  
  bfs = c("BFS_1", "BFS_2", "BFS_3", "BFS_4", "BFS_5", "BFS_6", "BFS_7", "BFS_8", "BFS_9", "BFS_10", "BFS_11", "BFS_12"),
##Bullshit Frequency scale evasive
  bfse = c("BFS_9", "BFS_10", "BFS_11", "BFS_12"),
##Bullshit Frequency scale persuasive
  bfsp = c("BFS_1", "BFS_2", "BFS_3", "BFS_4", "BFS_5", "BFS_6", "BFS_7", "BFS_8"),
##Bullshit Propensity scale 
  bps = c("BPS_1", "BPS_2", "BPS_3", "BPS_4", "BPS_5", "BPS_6", "BPS_7", "BPS_8", "BPS_9", "BPS_10", "BPS_11", "BPS_12"),
##Lying in Everyday Situations Scale
  lie = c("lies1", "lies2", "lies3", "lies4", "lies5", "lies6", "lies7", "lies8", "lies9", "lies10", "lies11", "lies12", "lies13", "lies14"),
##Short_dark_triad Narcissism
  sdtnarc = c("DTS_Nar_1", "DTS_Nar_2", "DTS_Nar_3", "DTS_Nar_4", "DTS_Nar_5", "DTS_Nar_6", "DTS_Nar_7", "DTS_Nar_8", "DTS_Nar_9"),
##Short_dark_triad Machiavellianism
  sdtmach = c("DTS_MACH_1", "DTS_MACH_2", "DTS_MACH_3", "DTS_MACH_4", "DTS_MACH_5", "DTS_MACH_6", "DTS_MACH_7", "DTS_MACH_8", "DTS_MACH_9"),
##Short_dark_triad Psychopathy
  sdtpsych = c("DTS_Path_1", "DTS_Path_2", "DTS_Path_3", "DTS_Path_4", "DTS_Path_5", "DTS_Path_6", "DTS_Path_7", "DTS_Path_8", "DTS_Path_9"),
##Machiavellianism Personality scale
  machi = c("MPS_1", "MPS_2", "MPS_3", "MPS_4", "MPS_5", "MPS_6", "MPS_7", "MPS_8", "MPS_9", "MPS_10", "MPS_11", "MPS_12", "MPS_13", "MPS_14", "MPS_15", "MPS_16"),
##Levenson Self-Report Psychopathy Scale
  psycho = c("LSRP_PPS_1", "LSRP_PPS_2", "LSRP_PPS_3", "LSRP_PPS_4", "LSRP_PPS_5", "LSRP_PPS_6", "LSRP_PPS_7", "LSRP_PPS_8", "LSRP_PPS_9", "LSRP_PPS_10", "LSRP_PPS_11", "LSRP_PPS_12", "LSRP_PPS_13", "LSRP_PPS_14", "LSRP_PPS_15", "LSRP_PPS_16", "LSRP_SPS_1", "LSRP_SPS_2", "LSRP_SPS_3", "LSRP_SPS_4", "LSRP_SPS_5", "LSRP_SPS_6", "LSRP_SPS_7", "LSRP_SPS_8", "LSRP_SPS_9", "LSRP_SPS_10"),
##primary factor of psychopathy scale
  psychoprim = c("LSRP_PPS_1", "LSRP_PPS_2", "LSRP_PPS_3", "LSRP_PPS_4", "LSRP_PPS_5", 
                    "LSRP_PPS_6", "LSRP_PPS_7", "LSRP_PPS_8", "LSRP_PPS_9", "LSRP_PPS_10", 
                    "LSRP_PPS_11", "LSRP_PPS_12", "LSRP_PPS_13", "LSRP_PPS_14", "LSRP_PPS_15", 
                    "LSRP_PPS_16"),
##secondary factor of psychopathy scale
  psychosec = c("LSRP_SPS_1", "LSRP_SPS_2", "LSRP_SPS_3", "LSRP_SPS_4", "LSRP_SPS_5", 
                    "LSRP_SPS_6", "LSRP_SPS_7", "LSRP_SPS_8", "LSRP_SPS_9", "LSRP_SPS_10"),
##Self-esteem (Rosenberg)
  se = c("self_esteem_1", "self_esteem_2", "self_esteem_3", "self_esteem_4", "self_esteem_5", 
                     "self_esteem_6", "self_esteem_7", "self_esteem_8", "self_esteem_9", "self_esteem_10"),
##HEXACO
##Honesty_humility
  hon = c("hex6", "hex12", "hex18", "hex24", "hex30", "hex36", "hex42", "hex48", "hex54", "hex60"),
##Emotionality
  emo = c("hex5", "hex11", "hex17", "hex23", "hex29", "hex35", "hex41", "hex47", "hex53", "hex59"),
##Extraversion
  extra = c("hex4", "hex10", "hex16", "hex22", "hex28", "hex34", "hex40", "hex46", "hex52", "hex58"),
##Agreeableness
  agree = c("hex3", "hex9", "hex15", "hex21", "hex27", "hex33", "hex39", "hex45", "hex51", "hex57"),
##CONSCIENTIOUSNESS
  cons = c("hex2", "hex8", "hex14", "hex20", "hex26", "hex32", "hex38", "hex44", "hex50", "hex56"),
##Openness to Experience
  open = c("hex1", "hex7", "hex13", "hex19", "hex25", "hex31", "hex37", "hex43", "hex49", "hex55"),
##Intellectual Humility Scale
  ihs = c("IHS_1", "IHS_2", "IHS_3", "IHS_4", "IHS_5", "IHS_6"),
##Need for Closure
  nclos = c("nclos1", "nclos2", "nclos3", "nclos4", "nclos5", "nclos6", "nclos7", "nclos8", "nclos9", "nclos10", 
                                                 "nclos11", "nclos12", "nclos13", "nclos14", "nclos15", 
                                                 "nclos16", "nclos17", "nclos18", "nclos19", "nclos20", 
                                                 "nclos21", "nclos22", "nclos23", "nclos24", "nclos25", 
                                                 "nclos26", "nclos27", "nclos28", "nclos29", "nclos30", 
                                                 "nclos31", "nclos32", "nclos33", "nclos34", "nclos35", 
                                                 "nclos36", "nclos37", "nclos38", "nclos39", "nclos40", 
                                                 "nclos41", "nclos42"),
##Need for Cognition
  ncog = c("ncog7", "ncog8", "ncog9", "ncog10", "ncog11", "ncog12", 
                                               "ncog13", "ncog14", "ncog15", "ncog16", "ncog17", "ncog18"),
##Actively Open Thinking Style
  openTS = c("A4CTS_1", "A4CTS_2", "A4CTS_3", "A4CTS_4", "A4CTS_5", "A4CTS_6"),
##Close-minded Thinking Style
  closeTS = c("A4CTS_7", "A4CTS_8", "A4CTS_9", "A4CTS_10", "A4CTS_11", "A4CTS_12"),
##prefer intuitive Thinking Style
  intuitiveTS = c("A4CTS_13", "A4CTS_14", "A4CTS_15", "A4CTS_16", "A4CTS_17", "A4CTS_18"),
##prefer effortful Thinking Style
  effortTS = c("A4CTS_19", "A4CTS_20", "A4CTS_21", "A4CTS_22", "A4CTS_23", "A4CTS_24"),
##Actively Open-Minded Thinking about Evidence Scale 
  Activeopen = c("aopen1", "aopen2", "aopen3", "aopen4", "aopen5", "aopen6", "aopen7", "aopen8"),
##Faith in Intuition Scale
  fi = c("fi1", "fi2", "fi3", "fi4", "fi5", "fi6", "fi7", "fi8", "fi9", "fi10", "fi11", "fi12")
)

##Loop through the scales and apply function
for (scale in names(scales)) {
  compute_scale_stats(Thesis_scale, scales[[scale]], toupper(scale))
}

##Convert results into a structured data frame
scale_stats_df <- data.frame(
  Scale = names(scale_stats),
  do.call(rbind, scale_stats)
)

##Display final results
print(scale_stats_df)
```




