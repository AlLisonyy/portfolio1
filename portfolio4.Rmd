---
title: "Thesis data Main Analysis"
author: "Allison Li"
date: "03242025"
output: 
  html_document:
    encoding: UTF-8
    toc: true
    number_sections: false
    toc_float: true
    toc_depth: 4
    fig_caption: true
---
For this portfolio, I will continue to use the dataset from my thesis study. This portfolio will focus on the main analysis for my thesis study's data, which is mainly correlation analysis. In addition, I would like to create some visualization for presenting the correlations since I have around 30 variables. 

```{r load-data, include=FALSE}
##install packages
##install.packages("corrplot")
##install.packages("plotly")
##install.packages("ggcorrplot")
##install.packages("reshape2")
##install.packages("cocor")

library(tibble)
library(cocor)
library(plotly)
library(ggcorrplot)
library(purrr)
library(reshape2)
library(corrplot)
library(psych)
library(ltm)
library(ppcor)
library(tidyverse)
library(haven)
Thesis_scale <- readRDS("Thesis_scale.rds")
```

## Step 1: partial correlations
### Bullshit Frequency scales and other variables's partial correlation when controled for lying tendency
```{r}
partial_ci <- function(r, n, conf_level = 0.95) {
  z <- 0.5 * log((1 + r) / (1 - r))
  se <- 1 / sqrt(n - 3)
  z_crit <- qnorm((1 + conf_level) / 2)
  
  z_lower <- z - z_crit * se
  z_upper <- z + z_crit * se
  
  r_lower <- (exp(2 * z_lower) - 1) / (exp(2 * z_lower) + 1)
  r_upper <- (exp(2 * z_upper) - 1) / (exp(2 * z_upper) + 1)
  
  return(c(lower = r_lower, upper = r_upper))
}
```

```{r BFS and others}
##1. BFS and BPS
pcor.test(Thesis_scale$BFS_score, Thesis_scale$BPS_score, Thesis_scale$LIE_score)

##2. BFS and narcissism (short scale)
partial_BFSsdtnarc <- Thesis_scale %>% 
  select(BFS_score, sdtnarc_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSsdtnarc$BFS_score, partial_BFSsdtnarc$sdtnarc_score, partial_BFSsdtnarc$LIE_score)
r <- 0.20
n <- 417
partial_ci(r, n)
##3, BFS and machiavellianism (short scale)
pcor.test(Thesis_scale$BFS_score, Thesis_scale$sdtmach_score, Thesis_scale$LIE_score)

##4. BFS and psychopathy (short scale)
pcor.test(Thesis_scale$BFS_score, Thesis_scale$sdtpsych_score, Thesis_scale$LIE_score)

##5.1 BFS and Narcissistic Personality Inventory
pcor.test(Thesis_scale$BFS_score, Thesis_scale$narcgrand_score, Thesis_scale$LIE_score)

##5.2 BFS and Hypersensitive Narcissism Scale
pcor.test(Thesis_scale$BFS_score, Thesis_scale$narchyper_score, Thesis_scale$LIE_score)

##6. BFS and Machiavellianism Personality scale
pcor.test(Thesis_scale$BFS_score, Thesis_scale$mach_score, Thesis_scale$LIE_score)

##7. BFS and Levenson Self-Report Psychopathy Scale
pcor.test(Thesis_scale$BFS_score, Thesis_scale$psycho_score, Thesis_scale$LIE_score)
##7.1
pcor.test(Thesis_scale$BFS_score, Thesis_scale$psychopri_score, Thesis_scale$LIE_score)
partial_BFSpsychosec <- Thesis_scale %>% 
  select(BFS_score, psychosec_score, LIE_score) %>%
  drop_na()
##7.2
pcor.test(partial_BFSpsychosec$BFS_score, partial_BFSpsychosec$psychosec_score, partial_BFSpsychosec$LIE_score)

##8. BFS and self-esteem
pcor.test(Thesis_scale$BFS_score, Thesis_scale$se_score, Thesis_scale$LIE_score)

##BFS and HEXACO
##9. Honesty-Humility
partial_BFShon<- Thesis_scale %>% 
  select(BFS_score, hon_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFShon$BFS_score, partial_BFShon$hon_score, partial_BFShon$LIE_score)
##10. Emotionality
partial_BFSemo <- Thesis_scale %>% 
  select(BFS_score, emo_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSemo$BFS_score, partial_BFSemo$emo_score, partial_BFSemo$LIE_score)
##11. Extraversion
partial_BFSextra <- Thesis_scale %>% 
  select(BFS_score, extra_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSextra$BFS_score, partial_BFSextra$extra_score, partial_BFSextra$LIE_score)
##12. Agreeableness
partial_BFSagree <- Thesis_scale %>% 
  select(BFS_score, agree_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSagree$BFS_score, partial_BFSagree$agree_score, partial_BFSagree$LIE_score)
##13. CONSCIENTIOUSNESS
partial_BFScons <- Thesis_scale %>% 
  select(BFS_score, cons_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFScons$BFS_score, partial_BFScons$cons_score, partial_BFScons$LIE_score)
##14. Openness
partial_BFSopen <- Thesis_scale %>% 
  select(BFS_score, open_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSopen$BFS_score, partial_BFSopen$open_score, partial_BFSopen$LIE_score)

##15. BFS and Intellectual Humility Scale


##16. BFS and Need for Closure
pcor.test(Thesis_scale$BFS_score, Thesis_scale$nclos_score, Thesis_scale$LIE_score)

##17. BFS and Need for Cognition
partial_BFSncog <- Thesis_scale %>% 
  select(BFS_score, ncog_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSncog$BFS_score, partial_BFSncog$ncog_score, partial_BFSncog$LIE_score)

##18. BFS and Actively Open Thinking Style
partial_BFSopenTS <- Thesis_scale %>% 
  select(BFS_score, openTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSopenTS$BFS_score, partial_BFSopenTS$openTS_score, partial_BFSopenTS$LIE_score)

##19. BFS and Close-minded Thinking Style
pcor.test(Thesis_scale$BFS_score, Thesis_scale$closeTS_score, Thesis_scale$LIE_score)

##20. BFS and prefer intuitive Thinking Style
partial_BFSintuitiveTS <- Thesis_scale %>% 
  select(BFS_score, intuitiveTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSintuitiveTS$BFS_score, partial_BFSintuitiveTS$intuitiveTS_score, partial_BFSintuitiveTS$LIE_score)

##21. BFS and prefer effortful Thinking Style
pcor.test(Thesis_scale$BFS_score, Thesis_scale$effortTS_score, Thesis_scale$LIE_score)

##22. BFS and Actively Open-Minded Thinking about Evidence Scale 
partial_BFSactiveopen <- Thesis_scale %>% 
  select(BFS_score, activeopen_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSactiveopen$BFS_score, partial_BFSactiveopen$activeopen_score, partial_BFSactiveopen$LIE_score)

##23. BFS and Faith in Intuition Scale
pcor.test(Thesis_scale$BFS_score, Thesis_scale$fi_score, Thesis_scale$LIE_score)

##24. BFS and BS thought listing and rating task
partial_BFSthoughlist <- Thesis_scale %>% 
  select(BFS_score, BSthought, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSthoughlist$BFS_score, partial_BFSthoughlist$BSthought, partial_BFSthoughlist$LIE_score)

##25. BFS and Wordsum Vocabulary Test
partial_BFSns <- Thesis_scale %>% 
  select(BFS_score, ns_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSns$BFS_score, partial_BFSns$ns_score, partial_BFSns$LIE_score)

##26. BFS and Numeracy scale
partial_BFSword <- Thesis_scale %>% 
  select(BFS_score, word_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSword$BFS_score, partial_BFSword$word_score, partial_BFSword$LIE_score)

##27. BFS and Cognitive Reflection Test
partial_BFScrt<- Thesis_scale %>% 
  select(BFS_score, crt_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFScrt$BFS_score, partial_BFScrt$crt_score, partial_BFScrt$LIE_score)

```

### Bullshit Frequency subscale BFSpersuasive and other variables's partial correlation when controled for lying tendency

```{r BFSp and others}
##1. BFSp and Thought listing and rating task
partial_BFSpthoughlist <- Thesis_scale %>% 
  select(BFSp_score, BSthought, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpthoughlist$BFSp_score, partial_BFSpthoughlist$BSthought, partial_BFSpthoughlist$LIE_score)

##2. BFSp and narcissism (short scale)
partial_BFSpsdtnarc <- Thesis_scale %>% 
  select(BFSp_score, sdtnarc_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpsdtnarc$BFSp_score, partial_BFSpsdtnarc$sdtnarc_score, partial_BFSpsdtnarc$LIE_score)

##3, BFSp and machiavellianism (short scale)
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$sdtmach_score, Thesis_scale$LIE_score)

##4. BFSp and psychopathy (short scale)
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$sdtpsych_score, Thesis_scale$LIE_score)

##5.1 BFSp and Narcissistic Personality Inventory
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$narcgrand_score, Thesis_scale$LIE_score)

##5.2 BFSp and Hypersensitive Narcissism Scale
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$narchyper_score, Thesis_scale$LIE_score)

##6. BFSp and Machiavellianism Personality scale
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$mach_score, Thesis_scale$LIE_score)

##7. BFSp and Levenson Self-Report Psychopathy Scale
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$psycho_score, Thesis_scale$LIE_score)
##7.1
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$psychopri_score, Thesis_scale$LIE_score)
partial_BFSppsychosec <- Thesis_scale %>% 
  select(BFSp_score, psychosec_score, LIE_score) %>% 
  drop_na()
##7.2
pcor.test(partial_BFSppsychosec$BFSp_score, partial_BFSppsychosec$psychosec_score, partial_BFSppsychosec$LIE_score)

##8. BFSp and self-esteem
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$se_score, Thesis_scale$LIE_score)

##BFSp and HEXACO
##9. Honesty-Humility
partial_BFSphon<- Thesis_scale %>% 
  select(BFSp_score, hon_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSphon$BFSp_score, partial_BFSphon$hon_score, partial_BFSphon$LIE_score)
##10. Emotionality
partial_BFSpemo <- Thesis_scale %>% 
  select(BFSp_score, emo_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpemo$BFSp_score, partial_BFSpemo$emo_score, partial_BFSpemo$LIE_score)
##11. Extraversion
partial_BFSpextra <- Thesis_scale %>% 
  select(BFSp_score, extra_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpextra$BFSp_score, partial_BFSpextra$extra_score, partial_BFSpextra$LIE_score)
##12. Agreeableness
partial_BFSpagree <- Thesis_scale %>% 
  select(BFSp_score, agree_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpagree$BFSp_score, partial_BFSpagree$agree_score, partial_BFSpagree$LIE_score)
##13. CONSCIENTIOUSNESS
partial_BFSpcons <- Thesis_scale %>% 
  select(BFSp_score, cons_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpcons$BFSp_score, partial_BFSpcons$cons_score, partial_BFSpcons$LIE_score)
##14. Openness
partial_BFSpopen <- Thesis_scale %>% 
  select(BFSp_score, open_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpopen$BFSp_score, partial_BFSpopen$open_score, partial_BFSpopen$LIE_score)

##15. BFSp and Intellectual Humility Scale


##16. BFSp and Need for Closure
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$nclos_score, Thesis_scale$LIE_score)

##17. BFSp and Need for Cognition
partial_BFSpncog <- Thesis_scale %>% 
  select(BFSp_score, ncog_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpncog$BFSp_score, partial_BFSpncog$ncog_score, partial_BFSpncog$LIE_score)

##18. BFSp and Actively Open Thinking Style
partial_BFSpopenTS <- Thesis_scale %>% 
  select(BFSp_score, openTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpopenTS$BFSp_score, partial_BFSpopenTS$openTS_score, partial_BFSpopenTS$LIE_score)

##19. BFSp and Close-minded Thinking Style
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$closeTS_score, Thesis_scale$LIE_score)

##20. BFSp and prefer intuitive Thinking Style
partial_BFSpintuitiveTS <- Thesis_scale %>% 
  select(BFSp_score, intuitiveTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpintuitiveTS$BFSp_score, partial_BFSpintuitiveTS$intuitiveTS_score, partial_BFSpintuitiveTS$LIE_score)

##21. BFSp and prefer effortful Thinking Style
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$effortTS_score, Thesis_scale$LIE_score)

##22. BFSp and Actively Open-Minded Thinking about Evidence Scale 
partial_BFSpactiveopen <- Thesis_scale %>% 
  select(BFSp_score, activeopen_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpactiveopen$BFSp_score, partial_BFSpactiveopen$activeopen_score, partial_BFSpactiveopen$LIE_score)

##23. BFSp and Faith in Intuition Scale
pcor.test(Thesis_scale$BFSp_score, Thesis_scale$fi_score, Thesis_scale$LIE_score)

##24. BFSp and Numeracy scale
partial_BFSpns <- Thesis_scale %>% 
  select(BFSp_score, ns_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpns$BFSp_score, partial_BFSpns$ns_score, partial_BFSpns$LIE_score)

##25. BFSp and Wordsum Vocabulary Test
partial_BFSpword <- Thesis_scale %>% 
  select(BFSp_score, word_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpword$BFSp_score, partial_BFSpword$word_score, partial_BFSpword$LIE_score)

##26. BFSp and Cognitive Reflection Test
partial_BFSpcrt<- Thesis_scale %>% 
  select(BFSp_score, crt_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpcrt$BFSp_score, partial_BFSpcrt$crt_score, partial_BFSpcrt$LIE_score)

##27. BFSp and BPS
partial_BFSpBPS<- Thesis_scale %>% 
  select(BFSp_score, BPS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpBPS$BFSp_score, partial_BFSpBPS$BPS_score, partial_BFSpBPS$LIE_score)

##28. BFSp and BFS
partial_BFSpBFS<- Thesis_scale %>% 
  select(BFSp_score, BFS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSpBFS$BFSp_score, partial_BFSpBFS$BFS_score, partial_BFSpBFS$LIE_score)
```

### Bullshit Frequency subscale BFSevasive and other variables's partial correlation when controled for lying tendency

```{r}
##1. BFSe and Thought listing and rating task
partial_BFSepthoughtist <- Thesis_scale %>% 
  select(BFSe_score, BSthought, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSepthoughtist$BFSe_score, partial_BFSepthoughtist$BSthought, partial_BFSepthoughtist$LIE_score)

##2. BFSe and narcissism (short scale)
partial_BFSesdtnarc <- Thesis_scale %>% 
  select(BFSe_score, sdtnarc_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSesdtnarc$BFSe_score, partial_BFSesdtnarc$sdtnarc_score, partial_BFSesdtnarc$LIE_score)

##3, BFSe and machiavellianism (short scale)
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$sdtmach_score, Thesis_scale$LIE_score)

##4. BFSe and psychopathy (short scale)
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$sdtpsych_score, Thesis_scale$LIE_score)

##5.1 BFSe and Narcissistic Personality Inventory
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$narcgrand_score, Thesis_scale$LIE_score)

##5.2 BFSe and Hypersensitive Narcissism Scale
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$narchyper_score, Thesis_scale$LIE_score)

##6. BFSe and Machiavellianism Personality scale
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$mach_score, Thesis_scale$LIE_score)

##7. BFSe and Levenson Self-Report Psychopathy Scale
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$psycho_score, Thesis_scale$LIE_score)
##7.1
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$psychopri_score, Thesis_scale$LIE_score)
partial_BFSepsychosec <- Thesis_scale %>% 
  select(BFSe_score, psychosec_score, LIE_score) %>% 
  drop_na()
##7.2
pcor.test(partial_BFSepsychosec$BFSe_score, partial_BFSepsychosec$psychosec_score, partial_BFSepsychosec$LIE_score)

##8. BFSe and self-esteem
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$se_score, Thesis_scale$LIE_score)

##BFSe and HEXACO
##9. Honesty-Humility
partial_BFSehon<- Thesis_scale %>% 
  select(BFSe_score, hon_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSehon$BFSe_score, partial_BFSehon$hon_score, partial_BFSehon$LIE_score)
##10. Emotionality
partial_BFSeemo <- Thesis_scale %>% 
  select(BFSe_score, emo_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeemo$BFSe_score, partial_BFSeemo$emo_score, partial_BFSeemo$LIE_score)
##11. Extraversion
partial_BFSeextra <- Thesis_scale %>% 
  select(BFSe_score, extra_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeextra$BFSe_score, partial_BFSeextra$extra_score, partial_BFSeextra$LIE_score)
##12. Agreeableness
partial_BFSeagree <- Thesis_scale %>% 
  select(BFSe_score, agree_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeagree$BFSe_score, partial_BFSeagree$agree_score, partial_BFSeagree$LIE_score)
##13. CONSCIENTIOUSNESS
partial_BFSecons <- Thesis_scale %>% 
  select(BFSe_score, cons_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSecons$BFSe_score, partial_BFSecons$cons_score, partial_BFSecons$LIE_score)
##14. Openness
partial_BFSeopen <- Thesis_scale %>% 
  select(BFSe_score, open_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeopen$BFSe_score, partial_BFSeopen$open_score, partial_BFSeopen$LIE_score)

##15. BFSe and Intellectual Humility Scale
partial_BFSeih <- Thesis_scale %>% 
  select(BFSe_score, ihs_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeih$BFSe_score, partial_BFSeih$ihs_score, partial_BFSeih$LIE_score)

##16. BFSe and Need for Closure
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$nclos_score, Thesis_scale$LIE_score)

##17. BFSe and Need for Cognition
partial_BFSencog <- Thesis_scale %>% 
  select(BFSe_score, ncog_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSencog$BFSe_score, partial_BFSencog$ncog_score, partial_BFSencog$LIE_score)

##18. BFSe and Actively Open Thinking Style
partial_BFSeopenTS <- Thesis_scale %>% 
  select(BFSe_score, openTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeopenTS$BFSe_score, partial_BFSeopenTS$openTS_score, partial_BFSeopenTS$LIE_score)

##19. BFSe and Close-minded Thinking Style
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$closeTS_score, Thesis_scale$LIE_score)

##20. BFSe and prefer intuitive Thinking Style
partial_BFSeintuitiveTS <- Thesis_scale %>% 
  select(BFSe_score, intuitiveTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeintuitiveTS$BFSe_score, partial_BFSeintuitiveTS$intuitiveTS_score, partial_BFSeintuitiveTS$LIE_score)

##21. BFSe and prefer effortful Thinking Style
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$effortTS_score, Thesis_scale$LIE_score)

##22. BFSe and Actively Open-Minded Thinking about Evidence Scale 
partial_BFSeactiveopen <- Thesis_scale %>% 
  select(BFSe_score, activeopen_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeactiveopen$BFSe_score, partial_BFSeactiveopen$activeopen_score, partial_BFSeactiveopen$LIE_score)

##23. BFSe and Faith in Intuition Scale
pcor.test(Thesis_scale$BFSe_score, Thesis_scale$fi_score, Thesis_scale$LIE_score)

##24. BFSe and Numeracy scale
partial_BFSens <- Thesis_scale %>% 
  select(BFSe_score, ns_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSens$BFSe_score, partial_BFSens$ns_score, partial_BFSens$LIE_score)

##25. BFSe and Wordsum Vocabulary Test
partial_BFSeword <- Thesis_scale %>% 
  select(BFSe_score, word_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeword$BFSe_score, partial_BFSeword$word_score, partial_BFSeword$LIE_score)

##26. BFSe and Cognitive Reflection Test
partial_BFSecrt<- Thesis_scale %>% 
  select(BFSe_score, crt_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSecrt$BFSe_score, partial_BFSecrt$crt_score, partial_BFSecrt$LIE_score)

##27. BFSe and BPS
partial_BFSeBPS<- Thesis_scale %>% 
  select(BFSe_score, BPS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeBPS$BFSe_score, partial_BFSeBPS$BPS_score, partial_BFSeBPS$LIE_score)

##28. BFSe and BFSp
partial_BFSeBFSp <- Thesis_scale %>% 
  select(BFSe_score, BFSp_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeBFSp$BFSe_score, partial_BFSeBFSp$BFSp_score, partial_BFSeBFSp$LIE_score)

##29. BFSe and BFS
partial_BFSeBFS <- Thesis_scale %>% 
  select(BFSe_score, BFS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BFSeBFS$BFSe_score, partial_BFSeBFS$BFS_score, partial_BFSeBFS$LIE_score)

```


### Bullshit Propensity scales and other variables's partial correlation when controled for lying tendency

```{r BPS and others}
##1. BPS and Thought listing and rating task
partial_BPSthoughlist <- Thesis_scale %>% 
  select(BPS_score, BSthought, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSthoughlist$BPS_score, partial_BPSthoughlist$BSthought, partial_BPSthoughlist$LIE_score)

##2. BPS and narcissism (short scale)
partial_BPSsdtnarc <- Thesis_scale %>% 
  select(BPS_score, sdtnarc_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSsdtnarc$BPS_score, partial_BPSsdtnarc$sdtnarc_score, partial_BPSsdtnarc$LIE_score)

##3, BPS and machiavellianism (short scale)
pcor.test(Thesis_scale$BPS_score, Thesis_scale$sdtmach_score, Thesis_scale$LIE_score)

##4. BPS and psychopathy (short scale)
pcor.test(Thesis_scale$BPS_score, Thesis_scale$sdtpsych_score, Thesis_scale$LIE_score)

##5.1 BPS and Narcissistic Personality Inventory
pcor.test(Thesis_scale$BPS_score, Thesis_scale$narcgrand_score, Thesis_scale$LIE_score)

##5.2 BPS and Hypersensitive Narcissism Scale
pcor.test(Thesis_scale$BPS_score, Thesis_scale$narchyper_score, Thesis_scale$LIE_score)

##6. BPS and Machiavellianism Personality scale
pcor.test(Thesis_scale$BPS_score, Thesis_scale$mach_score, Thesis_scale$LIE_score)

##7. BPS and Levenson Self-Report Psychopathy Scale
pcor.test(Thesis_scale$BPS_score, Thesis_scale$psycho_score, Thesis_scale$LIE_score)
##7.1
pcor.test(Thesis_scale$BPS_score, Thesis_scale$psychopri_score, Thesis_scale$LIE_score)
partial_BPSpsychosec <- Thesis_scale %>% 
  select(BPS_score, psychosec_score, LIE_score) %>% 
  drop_na()
##7.2
pcor.test(partial_BPSpsychosec$BPS_score, partial_BPSpsychosec$psychosec_score, partial_BPSpsychosec$LIE_score)

##8. BPS and self-esteem
pcor.test(Thesis_scale$BPS_score, Thesis_scale$se_score, Thesis_scale$LIE_score)

##BPS and HEXACO
##9. Honesty-Humility
partial_BPShon<- Thesis_scale %>% 
  select(BPS_score, hon_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPShon$BPS_score, partial_BPShon$hon_score, partial_BPShon$LIE_score)
##10. Emotionality
partial_BPSemo <- Thesis_scale %>% 
  select(BPS_score, emo_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSemo$BPS_score, partial_BPSemo$emo_score, partial_BPSemo$LIE_score)
##11. Extraversion
partial_BPSextra <- Thesis_scale %>% 
  select(BPS_score, extra_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSextra$BPS_score, partial_BPSextra$extra_score, partial_BPSextra$LIE_score)
##12. Agreeableness
partial_BPSagree <- Thesis_scale %>% 
  select(BPS_score, agree_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSagree$BPS_score, partial_BPSagree$agree_score, partial_BPSagree$LIE_score)
##13. CONSCIENTIOUSNESS
partial_BPScons <- Thesis_scale %>% 
  select(BPS_score, cons_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPScons$BPS_score, partial_BPScons$cons_score, partial_BPScons$LIE_score)
##14. Openness
partial_BPSopen <- Thesis_scale %>% 
  select(BPS_score, open_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSopen$BPS_score, partial_BPSopen$open_score, partial_BPSopen$LIE_score)

##15. BPS and Intellectual Humility Scale
partial_BPSih <- Thesis_scale %>% 
  select(BPS_score, ihs_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSih$BPS_score, partial_BPSih$ihs_score, partial_BPSih$LIE_score)

##16. BPS and Need for Closure
pcor.test(Thesis_scale$BPS_score, Thesis_scale$nclos_score, Thesis_scale$LIE_score)

##17. BPS and Need for Cognition
partial_BPSncog <- Thesis_scale %>% 
  select(BPS_score, ncog_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSncog$BPS_score, partial_BPSncog$ncog_score, partial_BPSncog$LIE_score)

##18. BPS and Actively Open Thinking Style
partial_BPSopenTS <- Thesis_scale %>% 
  select(BPS_score, openTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSopenTS$BPS_score, partial_BPSopenTS$openTS_score, partial_BPSopenTS$LIE_score)

##19. BPS and Close-minded Thinking Style
pcor.test(Thesis_scale$BPS_score, Thesis_scale$closeTS_score, Thesis_scale$LIE_score)

##20. BPS and prefer intuitive Thinking Style
partial_BPSintuitiveTS <- Thesis_scale %>% 
  select(BPS_score, intuitiveTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSintuitiveTS$BPS_score, partial_BPSintuitiveTS$intuitiveTS_score, partial_BPSintuitiveTS$LIE_score)

##21. BPS and prefer effortful Thinking Style
pcor.test(Thesis_scale$BPS_score, Thesis_scale$effortTS_score, Thesis_scale$LIE_score)

##22. BPS and Actively Open-Minded Thinking about Evidence Scale 
partial_BPSactiveopen <- Thesis_scale %>% 
  select(BPS_score, activeopen_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSactiveopen$BPS_score, partial_BPSactiveopen$activeopen_score, partial_BPSactiveopen$LIE_score)

##23. BPS and Faith in Intuition Scale
pcor.test(Thesis_scale$BPS_score, Thesis_scale$fi_score, Thesis_scale$LIE_score)

##24. BPS and Numeracy scale
partial_BPSns <- Thesis_scale %>% 
  select(BPS_score, ns_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSns$BPS_score, partial_BPSns$ns_score, partial_BPSns$LIE_score)

##25. BPS and Wordsum Vocabulary Test
partial_BPSword <- Thesis_scale %>% 
  select(BPS_score, word_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPSword$BPS_score, partial_BPSword$word_score, partial_BPSword$LIE_score)

##26. BPS and Cognitive Reflection Test
partial_BPScrt<- Thesis_scale %>% 
  select(BPS_score, crt_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BPScrt$BPS_score, partial_BPScrt$crt_score, partial_BPScrt$LIE_score)

```

### Bullshit Thought Listing and Rating tasks and other variables's partial correlation when controled for lying tendency

```{r thought listing / rating and others}

##1. BSthought rating and listing and narcissism (short scale)
partial_BSthoughtsdtnarc <- Thesis_scale %>% 
  select(BSthought, sdtnarc_score, LIE_score, knowledge_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtsdtnarc$BSthought, partial_BSthoughtsdtnarc$sdtnarc_score, partial_BSthoughtsdtnarc[, c("LIE_score", "knowledge_score")])

##2, BSthought and machiavellianism (short scale)
partial_BSthoughtsdtmach <- Thesis_scale %>% 
  select(BSthought, sdtmach_score, LIE_score, knowledge_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtsdtmach$BSthought, partial_BSthoughtsdtmach$sdtmach_score, partial_BSthoughtsdtmach[, c("LIE_score", "knowledge_score")])

##3. BSthought and psychopathy (short scale)
partial_BSthoughtsdtpsych <- Thesis_scale %>% 
  select(BSthought, sdtpsych_score, LIE_score, knowledge_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtsdtpsych$BSthought, partial_BSthoughtsdtpsych$sdtpsych_score, partial_BSthoughtsdtpsych[, c("LIE_score", "knowledge_score")])

##4.1 BSthought and Narcissistic Personality Inventory
partial_BSthoughtnarcgrand <- Thesis_scale %>% 
  select(BSthought, narcgrand_score, LIE_score, knowledge_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtnarcgrand$BSthought, partial_BSthoughtnarcgrand$narcgrand_score, partial_BSthoughtnarcgrand[, c("LIE_score", "knowledge_score")])

##4.2 BSthought and Hypersensitive Narcissism Scale
partial_BSthoughtnarchyper <- Thesis_scale %>% 
  select(BSthought, narchyper_score, LIE_score, knowledge_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtnarchyper$BSthought, partial_BSthoughtnarchyper$narchyper_score, partial_BSthoughtnarchyper[, c("LIE_score", "knowledge_score")])

##5. BSthought and Machiavellianism Personality scale
partial_BSthoughtmach <- Thesis_scale %>% 
  select(BSthought, mach_score, LIE_score, knowledge_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtmach$BSthought, partial_BSthoughtmach$mach_score, partial_BSthoughtmach[, c("LIE_score", "knowledge_score")])

##6. BSthought and Levenson Self-Report Psychopathy Scale
partial_BSthoughtpsych <- Thesis_scale %>% 
  select(BSthought, psycho_score, LIE_score, knowledge_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtpsych$BSthought, partial_BSthoughtpsych$psycho_score, partial_BSthoughtpsych[, c("LIE_score", "knowledge_score")])

##7. 
partial_BSthoughtpsychopri <- Thesis_scale %>% 
  select(BSthought, psychopri_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtpsychopri$BSthought, partial_BSthoughtpsychopri$psychopri_score, partial_BSthoughtpsychopri$LIE_score)

##8.
partial_BSthoughtpsychosec <- Thesis_scale %>% 
  select(BSthought, psychosec_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtpsychosec$BSthought, partial_BSthoughtpsychosec$psychosec_score, partial_BSthoughtpsychosec$LIE_score)

##9. BSthought and self-esteem
partial_BSthoughtse <- Thesis_scale %>% 
  select(BSthought, se_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtse$BSthought, partial_BSthoughtse$se_score, partial_BSthoughtse$LIE_score)

##BSthought and HEXACO
##10. Honesty-Humility
partial_BSthoughthon<- Thesis_scale %>% 
  select(BSthought, hon_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughthon$BSthought, partial_BSthoughthon$hon_score, partial_BSthoughthon$LIE_score)
##11. Emotionality
partial_BSthoughtemo <- Thesis_scale %>% 
  select(BSthought, emo_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtemo$BSthought, partial_BSthoughtemo$emo_score, partial_BSthoughtemo$LIE_score)
##12. Extraversion
partial_BSthoughtextra <- Thesis_scale %>% 
  select(BSthought, extra_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtextra$BSthought, partial_BSthoughtextra$extra_score, partial_BSthoughtextra$LIE_score)
##13. Agreeableness
partial_BSthoughtagree <- Thesis_scale %>% 
  select(BSthought, agree_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtagree$BSthought, partial_BSthoughtagree$agree_score, partial_BSthoughtagree$LIE_score)
##14. CONSCIENTIOUSNESS
partial_BSthoughtcons <- Thesis_scale %>% 
  select(BSthought, cons_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtcons$BSthought, partial_BSthoughtcons$cons_score, partial_BSthoughtcons$LIE_score)
##15. Openness
partial_BSthoughtopen <- Thesis_scale %>% 
  select(BSthought, open_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtopen$BSthought, partial_BSthoughtopen$open_score, partial_BSthoughtopen$LIE_score)

##16. BSthought and Intellectual Humility Scale
partial_BSthoughtih <- Thesis_scale %>% 
  select(BSthought, ihs_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtih$BSthought, partial_BSthoughtih$ihs_score, partial_BSthoughtih$LIE_score)

##17. BSthought and Need for Closure
partial_BSthoughtnclos <- Thesis_scale %>% 
  select(BSthought, nclos_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtnclos$BSthought, partial_BSthoughtnclos$nclos_score, partial_BSthoughtnclos$LIE_score)

##18. BSthought and Need for Cognition
partial_BSthoughtncog <- Thesis_scale %>% 
  select(BSthought, ncog_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtncog$BSthought, partial_BSthoughtncog$ncog_score, partial_BSthoughtncog$LIE_score)

##19. BSthought and Actively Open Thinking Style
partial_BSthoughtopenTS <- Thesis_scale %>% 
  select(BSthought, openTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtopenTS$BSthought, partial_BSthoughtopenTS$openTS_score, partial_BSthoughtopenTS$LIE_score)

##20. BSthought and Close-minded Thinking Style
partial_BSthoughtcloseTS <- Thesis_scale %>% 
  select(BSthought, closeTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtcloseTS$BSthought, partial_BSthoughtcloseTS$closeTS_score, partial_BSthoughtcloseTS$LIE_score)

##21. BSthought and prefer intuitive Thinking Style
partial_BSthoughtintuitiveTS <- Thesis_scale %>% 
  select(BSthought, intuitiveTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtintuitiveTS$BSthought, partial_BSthoughtintuitiveTS$intuitiveTS_score, partial_BSthoughtintuitiveTS$LIE_score)

##22. BSthought and prefer effortful Thinking Style
partial_BSthoughteffortTS <- Thesis_scale %>% 
  select(BSthought, effortTS_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughteffortTS$BSthought, partial_BSthoughteffortTS$effortTS_score, partial_BSthoughteffortTS$LIE_score)

##23. BSthought and Actively Open-Minded Thinking about Evidence Scale 
partial_BSthoughtactiveopen <- Thesis_scale %>% 
  select(BSthought, activeopen_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtactiveopen$BSthought, partial_BSthoughtactiveopen$activeopen_score, partial_BSthoughtactiveopen$LIE_score)

##24. BSthought and Faith in Intuition Scale
partial_BSthoughtfi <- Thesis_scale %>% 
  select(BSthought, fi_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtfi$BSthought, partial_BSthoughtfi$fi_score, partial_BSthoughtfi$LIE_score)

##25. BSthought and Wordsum Vocabulary Test
partial_BSthoughtns <- Thesis_scale %>% 
  select(BSthought, ns_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtns$BSthought, partial_BSthoughtns$ns_score, partial_BSthoughtns$LIE_score)

##26. BSthought and Numeracy scale
partial_BSthoughtword <- Thesis_scale %>% 
  select(BSthought, word_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtword$BSthought, partial_BSthoughtword$word_score, partial_BSthoughtword$LIE_score)

##27. BSthought and Cognitive Reflection Test
partial_BSthoughtcrt<- Thesis_scale %>% 
  select(BSthought, crt_score, LIE_score) %>% 
  drop_na()
pcor.test(partial_BSthoughtcrt$BSthought, partial_BSthoughtcrt$crt_score, partial_BSthoughtcrt$LIE_score)
```

### Partial conrrelations for BS thought when controling for both Lie scores and Self-reported knowledge
```{r}
##knowledge and bs thought
##each knowledge with BS thought listing


```


## Step 2: pearson correlation
### correlations for all the variables
```{r pearson correlation BSF}
##Test to see if the correlation test is what i am looking for:
cor.test(Thesis_scale$BSthought, Thesis_scale$ncog_score, method=c("pearson"))
cor.test(Thesis_scale$BSthought, Thesis_scale$ihs_score, method=c("pearson"))

##Correlations
bs_variables <- c("BFS_score", "BFSe_score", "BFSp_score", "BPS_score", "LIE_score", "sdtnarc_score", "sdtmach_score", "sdtpsych_score", "narcgrand_score", "narchyper_score", "mach_score", "psycho_score", "psychopri_score", "psychosec_score", "se_score", "hon_score", "emo_score", "extra_score", "agree_score", "cons_score", "open_score", "ihs_score", "nclos_score", "ncog_score", "openTS_score", "closeTS_score", "intuitiveTS_score", "effortTS_score", "activeopen_score", "fi_score", "crt_score", "word_score", "ns_score", "BSthought" )

correlates_bs <- Thesis_scale[, bs_variables]
correlates <- round(cor(correlates_bs, use = "pairwise.complete.obs"), 2)
corr_results <- corr.test(correlates_bs, use = "pairwise", method = "pearson")
corr_results$r      
corr_results$p

```

### heat map for correlations

```{r heatmap1, fig.width=12, fig.height=8}
## I have found how to do heat map for correlation matrix here: https://www.geeksforgeeks.org/how-to-create-correlation-heatmap-in-r/
## I want to make a heat map because I have almost 30 variables and I think this can be a good way for visualization

#First, I will need to create a correlation matrix
corr_mat <- round(cor(correlates_bs, use = "pairwise.complete.obs"), 2)
colnames(correlates_bs) <- gsub("_score", "", colnames(correlates_bs))

#Next, in order for better too look at, I will reorder the matrix by using corr coefficient as distance metric
dist <- as.dist((1-corr_mat)/2)
 
#Then, hierarchically clustering the dist matrix
hc <- hclust(dist)
corr_mat <-corr_mat[hc$order, hc$order]
 
#Also reduce the size of correlation matrix
melted_corr_mat <- melt(corr_mat)

#Lastly, I can plot the correlation heatmap
ggplot(data = melted_corr_mat, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile() +
  scale_fill_gradient2(low = "#ffa700", mid = "white", high = "#b53389", midpoint = 0) +
  theme_minimal() 
```

```{r heatmap2, fig.width=12, fig.height=8}
## Although the previous heat map is a good visualization, it does not provide any information for the excat number for each correlation value and the correlation between A and B is the same as between B and A, which makes the map redundant. Therefore, I find a more interactive heat map in the link that allows me to check for each variable and only show each correlation once. 
p_mat <- cor_pmat(correlates_bs)
##plotting the interactive corr heatmap
corr_mat <- ggcorrplot(
  corr_mat, hc.order = TRUE, type = "lower",
  outline.col = "white",
  p.mat = p_mat,
  insig = "blank", ##I added this code just to hide the insignificant ones, so it will not look messy
  colors = c("#281e5d", "white", "#ff4f00")
)
corr_mat <- corr_mat + theme(
  axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8),
  axis.text.y = element_text(size = 8)
)
corr_mat <- corr_mat + theme_minimal(base_size = 10)
ggplotly(corr_mat)

```

This looks pretty good! If you put your mouse on one of the color block (the correlation value), you will be able to see what two variables are correlated and what is the correlation value. It is really easy to see which has high correlation as well!

## Step 3: Hoteling test for the three types of BS measurements and the variables

```{r hoteling test}
## I also need to test the difference between two correlations that share one variable (Narcissism)
# Variables: r.jk = cor(BFS, Narc), r.jh = cor(BPS, Narc), r.kh = cor(BFS, BPS)
r_jk <- cor(Thesis_scale$BFS_score, Thesis_scale$narcgrand_score, use = "complete.obs")
r_jh <- cor(Thesis_scale$BPS_score, Thesis_scale$narcgrand_score, use = "complete.obs")
r_kh <- cor(Thesis_scale$BFS_score, Thesis_scale$BPS_score, use = "complete.obs")
n <- nrow(Thesis_scale)

# Then I need to run cocor for overlapping correlations
resultnarcgrand <- cocor.dep.groups.overlap(r.jk = r_jk, r.jh = r_jh, r.kh = r_kh, n = n)
resultnarcgrand@ hotelling1940
# See the results
print(resultnarcgrand)

##After this worked and I knwo what I want from the output, I decided to create a function for calculating the hoteling tests for all the variables. 
##List of variable names you want to compare against BFS and BPS
target_vars <- c("BFS_score", "BFSe_score", "BFSp_score", "BPS_score", "LIE_score", "sdtnarc_score", "sdtmach_score", "sdtpsych_score", "narcgrand_score", "narchyper_score", "mach_score", "psycho_score", "psychopri_score", "psychosec_score", "se_score", "hon_score", "emo_score", "extra_score", "agree_score", "cons_score", "open_score", "ihs_score", "nclos_score", "ncog_score", "openTS_score", "closeTS_score", "intuitiveTS_score", "effortTS_score", "activeopen_score", "fi_score", "crt_score", "word_score", "ns_score")

##create a function since there are too many variables to be put manually
compare_correlates <- function(var_name, x_name, y_name, Thesis_scale) {
  r_xy1 <- cor(Thesis_scale[[x_name]], Thesis_scale[[var_name]], use = "pairwise.complete.obs")
  r_xy2 <- cor(Thesis_scale[[y_name]], Thesis_scale[[var_name]], use = "pairwise.complete.obs")
  r_x1x2 <- cor(Thesis_scale[[x_name]], Thesis_scale[[y_name]], use = "pairwise.complete.obs")
  n <- nrow(Thesis_scale)
  result <- cocor.dep.groups.overlap(r.jk = r_xy1, r.jh = r_xy2, r.kh = r_x1x2, n = n)
  tibble(
    variable = var_name,
    r_pred1 = r_xy1,
    r_pred2 = r_xy2,
    r_variable = r_x1x2,
    p_Hotelling = tryCatch(result@hotelling1940$p.value, error = function(e) NA),
    p_Steiger = tryCatch(result@steiger1980$p.value, error = function(e) NA),
    conclusion = ifelse(!is.na(result@hotelling1940$p.value) && result@hotelling1940$p.value < 0.05, "Different", "Not Different"),
    hotelingt = result@ hotelling1940$statistic
  )
}

##Run for all 28 variables
# 1. BFS vs BPS
results_BFS_BPS <- map_dfr(target_vars, compare_correlates, x_name = "BFS_score", y_name = "BPS_score", Thesis_scale = Thesis_scale)

# 2. BFS vs BSthought
results_BFS_BSthought <- map_dfr(target_vars, compare_correlates, x_name = "BFS_score", y_name = "BSthought", Thesis_scale = Thesis_scale)

# 3. BPS vs BSthought
results_BPS_BSthought <- map_dfr(target_vars, compare_correlates, x_name = "BPS_score", y_name = "BSthought", Thesis_scale = Thesis_scale)

# 4. BFSe vs BPS
results_BFSe_BPS <- map_dfr(target_vars, compare_correlates, x_name = "BFSe_score", y_name = "BPS_score", Thesis_scale = Thesis_scale)

# 5. BFSp vs BPS
results_BFSp_BPS <- map_dfr(target_vars, compare_correlates, x_name = "BFSp_score", y_name = "BPS_score", Thesis_scale = Thesis_scale)

# 6. BFSe vs BSthought
results_BFSe_BSthought <- map_dfr(target_vars, compare_correlates, x_name = "BFSe_score", y_name = "BSthought", Thesis_scale = Thesis_scale)

# 7. BFSp vs BSthought
results_BFSp_BSthought <- map_dfr(target_vars, compare_correlates, x_name = "BFSp_score", y_name = "BSthought", Thesis_scale = Thesis_scale)

##View the results in a table
print(results_BFS_BPS)
print(results_BFS_BSthought)
print(results_BPS_BSthought)
print(results_BFSe_BPS)
print(results_BFSp_BPS)
print(results_BFSe_BSthought)
print(results_BFSp_BSthought)

```

```{r partial corre hoteling}
##Test the function first:
partial_corr1 <- pcor.test(Thesis_scale$BFS_score, Thesis_scale$narcgrand_score, Thesis_scale$LIE_score, method = "pearson")
partial_corr2 <- pcor.test(Thesis_scale$BPS_score, Thesis_scale$narcgrand_score, Thesis_scale$LIE_score, method = "pearson")
partial_corr3 <- pcor.test(Thesis_scale$BFS_score, Thesis_scale$BPS_score, Thesis_scale$LIE_score, method = "pearson")

# Extract the partial correlations
r_jk <- partial_corr1$estimate
r_jh <- partial_corr2$estimate
r_kh <- partial_corr3$estimate

# Sample size (n)
n <- nrow(Thesis_scale)

# Perform the Hotelling's test using cocor
resultnarcgrand <- cocor.dep.groups.overlap(r.jk = r_jk, r.jh = r_jh, r.kh = r_kh, n = n)

# Display the results
print(resultnarcgrand)

##Now I know it works fine, I can create another function for partial correlation
compare_partial_correlates <- function(var_name, x_name, y_name, control_vars, Thesis_scale) {
  Thesis_scale_filtered <- Thesis_scale %>%
    dplyr::select(all_of(c(var_name, x_name, y_name, "LIE_score"))) %>%
    na.omit()
  
#Calculate partial correlations, controlling for the lying tendency
  partial_corr1 <- pcor.test(Thesis_scale_filtered[[x_name]], Thesis_scale_filtered[[var_name]], Thesis_scale_filtered[["LIE_score"]], method = "pearson")
  partial_corr2 <- pcor.test(Thesis_scale_filtered[[y_name]], Thesis_scale_filtered[[var_name]], Thesis_scale_filtered[["LIE_score"]], method = "pearson")
  partial_corr3 <- pcor.test(Thesis_scale_filtered[[x_name]], Thesis_scale_filtered[[y_name]], Thesis_scale_filtered[["LIE_score"]], method = "pearson")
 
##Getting the partial correlation estimates  
  r_jk <- as.numeric(partial_corr1$estimate)
  r_jh <- as.numeric(partial_corr2$estimate)
  r_kh <- as.numeric(partial_corr3$estimate)
  n <- nrow(Thesis_scale_filtered)
# Run the cocor function for comparison
  result <- tryCatch({
    cocor.dep.groups.overlap(r.jk = r_jk, r.jh = r_jh, r.kh = r_kh, n = n)
  }, error = function(e) NULL)
# Handle case where result is NULL (i.e., error occurred)
  if (is.null(result)) {
    return(tibble(
      variable = var_name,
      r_pred1 = r_jk,
      r_pred2 = r_jh,
      r_variable = r_kh,
      p_Hotelling = NA,
      p_Steiger = NA,
      conclusion = "Error in Test",
      hotelingt = NA
    ))
  }
# tibble  
  tibble(
    variable = var_name,
    r_pred1 = r_jk,
    r_pred2 = r_jh,
    r_variable = r_kh,
    p_Hotelling = tryCatch(result@hotelling1940$p.value, error = function(e) NA),
    p_Steiger = tryCatch(result@steiger1980$p.value, error = function(e) NA),
    conclusion = ifelse(!is.na(result@hotelling1940$p.value) && result@hotelling1940$p.value < 0.05, "Different", "Not Different"),
    hotelingt = tryCatch(result@hotelling1940$statistic, error = function(e) NA)
  )}

# 1. BFS vs BPS
results_BFS_BPS_partial <- map_dfr(target_vars, compare_partial_correlates, 
                                   x_name = "BFS_score", y_name = "BPS_score", Thesis_scale = Thesis_scale)
# 2. BFS vs BSthought
results_BFS_BSthought_partial <- map_dfr(target_vars, compare_partial_correlates, x_name = "BFS_score", y_name = "BSthought", Thesis_scale = Thesis_scale)

# 3. BPS vs BSthought
results_BPS_BSthought_partial <- map_dfr(target_vars, compare_partial_correlates, x_name = "BPS_score", y_name = "BSthought", Thesis_scale = Thesis_scale)

# 4. BFSe vs BPS
results_BFSe_BPS_partial <- map_dfr(target_vars, compare_partial_correlates, x_name = "BFSe_score", y_name = "BPS_score", Thesis_scale = Thesis_scale)

# 5. BFSp vs BPS
results_BFSp_BPS_partial <- map_dfr(target_vars, compare_partial_correlates, x_name = "BFSp_score", y_name = "BPS_score", Thesis_scale = Thesis_scale)

# 6. BFSe vs BSthought
results_BFSe_BSthought_partial <- map_dfr(target_vars, compare_partial_correlates, x_name = "BFSe_score", y_name = "BSthought", Thesis_scale = Thesis_scale)

# 7. BFSp vs BSthought
results_BFSp_BSthought_partial <- map_dfr(target_vars, compare_partial_correlates, x_name = "BFSp_score", y_name = "BSthought", Thesis_scale = Thesis_scale)

##View the results in a table
print(results_BFS_BPS_partial)
print(results_BFS_BSthought_partial)
print(results_BPS_BSthought_partial)
print(results_BFSe_BPS_partial)
print(results_BFSp_BPS_partial)
print(results_BFSe_BSthought_partial)
print(results_BFSp_BSthought_partial)
```


```{r}
saveRDS(Thesis_scale, file = "Thesis_scale.rds")
write_sav(Thesis_scale, "Thesis_scale.sav")
```

